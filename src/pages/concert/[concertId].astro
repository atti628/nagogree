---
import Layout from '../../layouts/Layout.astro';
import { getConcerts } from "../../library/microcms";

// 1. 静的パス生成
export async function getStaticPaths() {
  const response = await getConcerts({ limit: 100 });
  return response.contents.map((concert) => ({
    params: { concertId: concert.id },
    props: { concert },
  }));
}

// 2. データ受け取り
const { concert } = Astro.props;

// 3. 日付判定 (今日より未来か過去か？)
const today = new Date().toISOString();
const isUpcoming = concert.date >= today;

// ヘッダー設定（共通デザイン）
const pageInfo = {
  title: "CONCERT",
  subtitle: "演奏会情報",
  bgImage: "/images/IMG_3947.JPG",
};
---

<Layout title={`${concert.title} | NagoGree`}>

  <div class="relative h-[40vh] min-h-[300px] flex items-center justify-center bg-cover bg-center" 
       style={`background-image: url('${pageInfo.bgImage}');`}>
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative z-10 text-center text-white">
      <h1 class="text-5xl md:text-6xl font-black tracking-widest drop-shadow-[0_0_15px_rgba(255,255,255,0.8)] mb-2">
        {pageInfo.title}
      </h1>
      <p class="text-lg font-bold tracking-[0.2em] opacity-90">{pageInfo.subtitle}</p>
    </div>
  </div>

  <div class="bg-[#FDFBF7] py-20 px-4 text-black">
    <div class="max-w-3xl mx-auto bg-white p-8 md:p-12 shadow-lg border border-[#DDCBB4] rounded-sm">
      
      <div class="mb-4">
        {isUpcoming ? (
          <span class="bg-[#228B22] text-white text-xs font-bold px-3 py-1 rounded-full tracking-wider inline-block">
            COMING SOON
          </span>
        ) : (
          <span class="bg-gray-500 text-white text-xs font-bold px-3 py-1 rounded-sm tracking-widest inline-block">
            FINISHED
          </span>
        )}
      </div>

      <h1 class="text-2xl md:text-4xl font-black leading-tight text-black mb-4">
        {concert.title}
      </h1>

      <p class="text-[#228B22] font-bold text-xl tracking-widest mb-10 border-b border-[#DDCBB4] pb-6">
        {new Date(concert.date).toLocaleDateString("ja-JP", { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' })}
      </p>

      {concert.image && (
        <div class="mb-10 w-full bg-gray-50">
          <img src={concert.image.url} alt={concert.title} class="w-full h-auto object-contain max-h-[600px] mx-auto" />
        </div>
      )}

      <div class="rich-text text-gray-800 leading-loose" set:html={concert.content} />

      {concert.ticketUrl && isUpcoming && (
        <div class="mt-12 text-center">
          <a href={concert.ticketUrl} target="_blank" rel="noopener noreferrer" class="inline-block bg-[#228B22] text-white font-bold py-4 px-12 shadow-md hover:bg-[#1a6b1a] hover:shadow-lg hover:-translate-y-1 transition-all duration-300 tracking-widest rounded-sm">
            チケットはこちらから
          </a>
          <p class="text-xs text-gray-500 mt-2">※ 外部サイトへ移動します</p>
        </div>
      )}

      <div class="mt-16 text-center border-t border-[#DDCBB4] pt-8">
        <a href="/concert" class="inline-block text-[#228B22] font-bold hover:underline tracking-widest">
          ← 演奏会一覧に戻る
        </a>
      </div>

    </div>
  </div>

</Layout>

<style is:global>
  /* リッチテキストのデザイン設定 */
  .rich-text p { margin-bottom: 1.5em; line-height: 1.8; }
  .rich-text h2 { font-size: 1.5em; font-weight: bold; color: #228B22; margin-top: 2em; margin-bottom: 1em; border-bottom: 1px solid #DDCBB4; }
  .rich-text h3 { font-size: 1.25em; font-weight: bold; margin-top: 1.5em; margin-bottom: 0.5em; }
  .rich-text ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1.5em; }
  .rich-text ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1.5em; }
  .rich-text a { color: #228B22; text-decoration: underline; }
</style>